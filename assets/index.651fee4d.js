import{i as e,o as t,c as s,a,t as o,n as r,b as i,p as n,d as l,u as d,e as c,r as p,f as u,F as m,g as f,h as y,j as g,k as h,K as v,v as b,l as _,m as x,w,q as k,s as N,x as S}from"./vendor.c8fc752c.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var P=(e,t)=>{for(const[s,a]of t)e[s]=a;return e};const I=[(e=>(n("data-v-25fc2a68"),e=e(),l(),e))((()=>a("div",{class:"sg-element__icon"},[a("div",{class:"sg-element__icon-spark"}),a("div",{class:"sg-element__icon-core"})],-1)))],L={class:"sg-element__title"};var T=P({props:{item:Object,className:String},setup(n){const l=n,d=e("audio"),c=e=>{e.dataTransfer.setData("payload",JSON.stringify({type:"element",element:l.item})),d.play("element-pickup")};return(e,l)=>(t(),s("div",{class:r(`${n.className} sg-element`),style:i({"--primary":n.item.colors.primary,"--secondary":n.item.colors.secondary})},[a("div",{class:"sg-element__orb",onDragstart:c,draggable:"true"},I,32),a("div",L,o(n.item.label),1)],6))}},[["__scopeId","data-v-25fc2a68"]]);const E=[(e=>(n("data-v-fd5ad1aa"),e=e(),l(),e))((()=>a("div",{class:"sg-source__icon"},[a("div",{class:"sg-source__icon-core"})],-1)))],M={class:"sg-source__title"};var C=P({props:{item:Object,className:String},setup(e){const n=e,l=e=>{e.dataTransfer.setData("payload",JSON.stringify({type:"source",source:n.item}))};return(n,d)=>(t(),s("div",{class:r(`${e.className} sg-source`),style:i({"--primary":e.item.colors.primary,"--secondary":e.item.colors.secondary})},[a("div",{draggable:"true",onDragstart:l},E,32),a("div",M,o(e.item.label),1)],6))}},[["__scopeId","data-v-fd5ad1aa"]]);const A=e=>(n("data-v-3c514f73"),e=e(),l(),e),B={class:"spell-menu"},D={class:"spell-menu__bar"},O={key:0,class:"spell-menu__wrapper"},j=A((()=>a("div",{class:"spell-menu__title"},"Элементы",-1))),H={class:"spell-menu__container"},R={key:1,class:"spell-menu__wrapper"},$=A((()=>a("div",{class:"spell-menu__title"},"Источники силы",-1))),F={class:"spell-menu__container"},J={key:2,class:"spell-menu__wrapper"},K=[A((()=>a("div",{class:"spell-menu__title"},"Базы",-1))),A((()=>a("div",{class:"spell-menu__container"},null,-1)))],q={key:3,class:"spell-menu__wrapper"},z=[A((()=>a("div",{class:"spell-menu__title"},"Формы",-1))),A((()=>a("div",{class:"spell-menu__container"},null,-1)))];var W=P({setup(e){const o=d(),i=c((()=>o.getters["elements/baseElements"])),n=c((()=>o.state.sources.sources));console.log(n);let l=p({activeTab:0});return(e,o)=>(t(),s("div",B,[a("div",D,[a("div",{class:r(["spell-menu__bar-item",{active:0===u(l).activeTab}]),onClick:o[0]||(o[0]=e=>u(l).activeTab=0)}," Элементы ",2),a("div",{class:r(["spell-menu__bar-item",{active:1===u(l).activeTab}]),onClick:o[1]||(o[1]=e=>u(l).activeTab=1)}," Источники ",2),a("div",{class:r(["spell-menu__bar-item",{active:2===u(l).activeTab}]),onClick:o[2]||(o[2]=e=>u(l).activeTab=2)}," Базы ",2),a("div",{class:r(["spell-menu__bar-item",{active:3===u(l).activeTab}]),onClick:o[3]||(o[3]=e=>u(l).activeTab=3)}," Формы ",2)]),0===u(l).activeTab?(t(),s("div",O,[j,a("div",H,[(t(!0),s(m,null,f(u(i),(e=>(t(),g(T,{className:"spell-menu__item",item:e,key:e.id},null,8,["item"])))),128))])])):y("",!0),1===u(l).activeTab?(t(),s("div",R,[$,a("div",F,[(t(!0),s(m,null,f(u(n),(e=>(t(),g(C,{className:"spell-menu__item",item:e,key:e.id},null,8,["item"])))),128))])])):y("",!0),2===u(l).activeTab?(t(),s("div",J,K)):y("",!0),3===u(l).activeTab?(t(),s("div",q,z)):y("",!0)]))}},[["__scopeId","data-v-3c514f73"]]);const G=[{id:"light",label:"Свет",description:"Яркий ослепляющий свет",colors:{primary:"#fff952",secondary:"#fffdbd"}},{id:"dark",label:"Тьма",description:"Всепоглощающая тьма",colors:{primary:"#3c0078",secondary:"#290052"}},{id:"fire",label:"Огонь",description:"Жаркое пламя",colors:{primary:"#e34f00",secondary:"#e38400"}},{id:"water",label:"Вода",description:"Быстротечная вода",colors:{primary:"#006bbd",secondary:"#7ac5ff"}},{id:"air",label:"Ветер",description:"Вольный ветер",colors:{primary:"#e0feff",secondary:"#edfeff"}},{id:"earth",label:"Земля",description:"Твердь земная",colors:{primary:"#914b00",secondary:"#784e22"}},{id:"electricity",label:"Молния",description:"Неудержимая молния",colors:{primary:"#ffd000",secondary:"#bdfdff"}},{id:"chaos",label:"Хаос",description:"Хаос что неподвластен смертным",parents:[["light","dark"]],colors:{primary:"#9d7c65",secondary:"#947e87"}},{id:"white_fire",label:"Белое Пламя",description:"Пламя что ослепляет своим сиянием!",parents:[["light","fire"]],colors:{primary:"#f1a429",secondary:"#f1c05e"}},{id:"black_fire",label:"Черное пламя",description:"Пламя что пожирает сам свет!",parents:[["dark","fire"]],colors:{primary:"#8f273c",secondary:"#864229"}},{id:"holy_water",label:"Святая Вода",description:"Чистая вода словно слеза Бога!",parents:[["light","water"]],colors:{primary:"#7fb287",secondary:"#bce1de"}},{id:"poison",label:"Яд",description:"Смертельный яд!",parents:[["electricity","water"],["dark","water"],["dark","air"]],colors:{primary:"#7f9d5e",secondary:"#9be1ff"}},{id:"steam",label:"Пар",description:"Непроглядные клубы пара!",parents:[["fire","water"]],colors:{primary:"#715d5e",secondary:"#aea47f"}},{id:"flash",label:"Вспышка",description:"Яркое сияние что лишает зрения!",parents:[["light","air"]],colors:{primary:"#effba8",secondary:"#f6fdde"}},{id:"fire_tornado",label:"Огненое торнадо",description:"Ураган пламени что разрушает и превращает в пепел все на своем пути!",parents:[["fire","air"]],colors:{primary:"#e1a67f",secondary:"#e8c17f"}},{id:"ice",label:"Лед",description:"Глыба льда что тверже камня!",parents:[["air","water"]],colors:{primary:"#70b4de",secondary:"#b3e1ff"}},{id:"life",label:"Жизнь",description:"Источник жизненой сили!",parents:[["light","earth"]],colors:{primary:"#c8a229",secondary:"#bba56f"}},{id:"corruption",label:"Разложение",description:"Разрушительное влияние что отравляет саму суть вещей!",parents:[["dark","earth"]],colors:{primary:"#66253c",secondary:"#50273a"}},{id:"lava",label:"Лава",description:"Поток жаркой магмы!",parents:[["fire","earth"]],colors:{primary:"#ba4d00",secondary:"#ad6911"}},{id:"tree",label:"Дерево",description:"Дерево породы что тверже самой стали!",parents:[["water","earth"]],colors:{primary:"#485b5e",secondary:"#798990"}},{id:"dust",label:"Пыль",description:"Мелкие частички земли способные забрятся куда угодно!",parents:[["air","earth"]],colors:{primary:"#b8a47f",secondary:"#b2a690"}},{id:"teleport",label:"Телепорт",description:"Мгновенное перемещение материи на любые растояния!",parents:[["electricity","light"]],colors:{primary:"#ffe429",secondary:"#defdde"}},{id:"dark_ightning",label:"Темная молния",description:"Мновенный разряд енергии что поражает саму суть души!",parents:[["electricity","dark"]],colors:{primary:"#9d683c",secondary:"#737ea8"}},{id:"plasma",label:"Плазма",description:"Поток вещества что горячее самого Солнца!",parents:[["electricity","fire"],["electricity","air"]],colors:{primary:"#f18f00",secondary:"#d0c07f"}},{id:"explosion",label:"Взрыв",description:"Ударная волна енергии!",parents:[["electricity","earth"]],colors:{primary:"#c88d00",secondary:"#9aa590"}}];var U={namespaced:!0,state:()=>({elements:[...G]}),mutations:{addElement(e,t){e.elements.push(t)}},getters:{getElementById:e=>t=>e.elements.find((e=>e.id===t)),baseElements:e=>e.elements.filter((e=>!e.parents)),getElementByParentElements:e=>t=>{if(t[0]&&t[1]){let s=t.map((e=>e.id));return e.elements.find((e=>{var t;return null==(t=e.parents)?void 0:t.some((e=>e.every((e=>s.includes(e)))))}))}}},actions:{}};const V=()=>[...X],X=[{id:"mana",label:"Мана",colors:{primary:"#0037c2",secondary:"#9ebaff"}},{id:"divine",label:"Божественная",colors:{primary:"#ffcb1f",secondary:"#ffedb3"}},{id:"demonic",label:"Демоническая",colors:{primary:"#780016",secondary:"#4a1d25"}},{id:"astral",label:"Астральная",colors:{primary:"#00c6d4",secondary:"#d885ff"}}];console.log(V());var Q={namespaced:!0,state:()=>({sources:V()}),mutations:{},getters:{getSourceById:e=>t=>e.sources.find((e=>e.id===t))},actions:{}};const Y=[{id:"rectangle",name:"Rectangle"}];var Z={namespaced:!0,state:()=>({bases:[...Y]}),mutations:{},getters:{getBaseById:e=>t=>e.sources.find((e=>e.id===t))},actions:{}};var ee={namespaced:!0,state:()=>({apexes:{},cores:{}}),mutations:{addApex(e,{id:t,element:s}){e.apexes[t]={element:s}},removeApex(e,{id:t}){delete e.apexes[t]},addCore(e,{id:t,source:s}){e.cores[t]={source:s}},removeCore(e,{id:t,source:s}){e.cores[t]={source:s}},reset(e){e.base={},e.apexes={},e.sources={}}},getters:{},actions:{digestSynergies({commit:e,state:t,rootGetters:s}){for(const a in t.apexes){let o=t.apexes[a];if(o.parents){let r=[t.apexes[o.parents[0]].element,t.apexes[o.parents[1]].element],i=s["elements/getElementByParentElements"](r);i&&e("setElementToApex",{apexId:a,element:i})}}}}},te=h({modules:{elements:U,sources:Q,bases:Z,spell:ee},state:{loaded:{audio:!1},dashboard:{element:null}},mutations:{loaded(e,{system:t,loaded:s}){e.loaded[t]=s},setDashboardElement(e,{element:t}){console.log("setted",t),e.dashboard.element=t}},getters:{isLoading:e=>e.loaded.audio},actions:{dropElement({commit:e,dispatch:t,getters:s},{apexId:a,elementId:o}){e("spell/setElementToApex",{apexId:a,element:s["elements/getElementById"](o)}),t("spell/digestSynergies")},dropSource({commit:e,getters:t},{coreId:s,sourceId:a}){e("spell/setSourceToCore",{coreId:s,source:t["source/getSourceById"](a)})}}});class se{constructor(e,t){this.context=e,this.urls=t,this.buffer={},this.loaded=new Promise(((e,t)=>{this.resolve=e})),this.loadAll()}loadSound(e,t){let s=new XMLHttpRequest;s.open("get",e,!0),s.responseType="arraybuffer",s.onload=()=>{this.context.decodeAudioData(s.response,(e=>{this.buffer[t]=e,Object.keys(this.buffer).length==Object.keys(this.urls).length&&this.resolve()}))},s.send()}loadAll(){for(const e in this.urls)this.loadSound(this.urls[e],e)}getSoundByKey(e){return this.buffer[e]}}class ae{constructor(e,t,s){this.context=e,this.buffer=t,this.options=s}setup(){const{loop:e,volume:t}=this.options;this.gainNode=this.context.createGain(),this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.source.loop=e,isFinite(t)&&(this.gainNode.gain.value=t)}play(){return this.setup(),this.source.start(this.context.currentTime),this}stop(){return this.gainNode.gain.exponentialRampToValueAtTime(.001,this.context.currentTime+.5),this.source.stop(this.context.currentTime+.5),this}}var oe={instance:new class{constructor(e){this._name="vue-audio",this._ctx=null,this.__tracklist={},this.initAudioContext(),this._buffer=new se(this._ctx,e),this.loaded=this._buffer.loaded}play(e,t={}){new ae(this._ctx,this._buffer.getSoundByKey(e),t).play()}initAudioContext(){try{this._ctx=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.error(`${this._name}: Failed to initialize audio context`,e)}}}({"base-appear":"sound/base-appear.wav","spell-generating":"sound/spell-generating.wav","element-pickup":"sound/element-pickup.wav","element-place-fail":"sound/element-place-fail.wav","element-drop":"sound/element-drop.wav",background:"sound/background.mp3"}),install(e){e.provide("audio",this.instance)}};const re=p({stage:null,layer:null,selectedNode:null,selectedLink:null,connections:[],isContextMenuShown:!1,contextMenuPosition:{top:0,left:0}}),ie=te,ne=oe.instance,le=new Image;le.src="/spell-game/assets/orb-pattern-o3.ce97c15a.png";const de=({container:e,width:t,height:s})=>{re.stage=new v.Stage({id:"stage",container:e,width:t,height:s}),re.layer=new v.Layer,re.stage.add(re.layer),re.stage.on("contextmenu",ge),re.stage.on("mousemove",ye),re.stage.container().addEventListener("dragover",(e=>e.preventDefault())),re.stage.container().addEventListener("drop",he),document.addEventListener("click",me)},ce=()=>{if(re.selectedNode){switch(re.selectedNode.name()){case"element":ie.commit("spell/removeApex",{id:re.selectedNode.id()})}re.selectedNode.destroy(),re.selectedNode=null}},pe=()=>{if(re.selectedNode){let t=b();var e=new v.Line({points:we([{pos:re.selectedNode.getAbsolutePosition(),radius:re.selectedNode.getAttr("radius")},{pos:re.stage.getPointerPosition(),radius:5}]),id:t,name:"connection",stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"});re.selectedLink={nodes:[re.selectedNode],lineNode:e},re.layer.add(e)}},ue=e=>{re.selectedLink&&(re.connections.push({lineNode:re.selectedLink.lineNode,nodes:[...re.selectedLink.nodes,e.target]}),re.selectedLink=null,_e())},me=()=>{re.isContextMenuShown=!1,re.selectedNode=null},fe=e=>{xe(e.target),_e()},ye=()=>{re.selectedLink&&re.selectedLink.lineNode.points(we([{pos:re.selectedLink.nodes[0].getAbsolutePosition(),radius:re.selectedLink.nodes[0].getAttr("radius")},{pos:re.stage.getPointerPosition(),radius:5}]))},ge=e=>{if(e.evt.preventDefault(),"stage"===e.target.id())return;re.isContextMenuShown=!0,re.isContextMenuShown=!0,re.selectedNode=e.target;let t=re.stage.container().getBoundingClientRect(),s=re.stage.getPointerPosition();re.contextMenuPosition={top:`${t.top+s.y}px`,left:`${t.left+s.x}px`}},he=e=>{e.preventDefault(),re.stage.setPointersPositions(e);let t=JSON.parse(e.dataTransfer.getData("payload"));switch(t.type){case"element":be(t.element);break;case"source":ve(t.source)}},ve=e=>{let t=b();var s=new v.Shape({id:t,name:"source",radius:50,width:100,height:100,draggable:!0,fillPatternImage:le,fillPatternOffset:{x:250,y:250},fillPatternScale:{x:.2,y:.2},fillPatternRepeat:"no-repeat",shadowColor:e.colors.secondary,shadowBlur:5,sceneFunc:function(t,s){t.beginPath(),t.arc(0,0,s.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStyle=e.colors.primary,t.fill(),t.arc(0,0,s.attrs.radius||0,0,2*Math.PI,!1),t.fillStrokeShape(s)}});s.position(re.stage.getPointerPosition()),s.on("dragmove",fe),s.on("click",ue),re.layer.add(s),ie.commit("spell/addCore",{id:t,source:e})},be=e=>{let t=b();var s=new v.Circle({id:t,name:"element",radius:20,fill:e.colors.primary,shadowColor:e.colors.secondary,shadowBlur:5,draggable:!0});s.position(re.stage.getPointerPosition()),s.on("dragmove",fe),s.on("click",ue),re.layer.add(s),ie.commit("spell/addApex",{id:t,element:e}),ne.play("element-drop")},_e=()=>{re.connections.forEach((e=>{e.lineNode.points(we([{pos:e.nodes[0].getAbsolutePosition(),radius:e.nodes[0].getAttr("radius")},{pos:e.nodes[1].getAbsolutePosition(),radius:e.nodes[1].getAttr("radius")}]))}))},xe=e=>{let t=re.stage.size(),s=e.height()/2,a=t.height-e.height()/2,o=e.width()/2,r=t.width-e.width()/2;e.y(Math.min(Math.max(s,e.y()),a)),e.x(Math.min(Math.max(o,e.x()),r))},we=([e,t])=>{let{pos:s,radius:a}=e,{pos:o,radius:r}=t;a+=5,r+=5;const i=o.x-s.x,n=o.y-s.y;let l=Math.atan2(-n,i);return[s.x+-a*Math.cos(l+Math.PI),s.y+a*Math.sin(l+Math.PI),o.x+-r*Math.cos(l),o.y+r*Math.sin(l)]};var ke=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",state:re,initStage:de,removeNode:ce,combineNode:()=>{},linkNode:pe});const Ne={class:"spell-canvas__wrapper"};var Se=P({setup(e){const o=_(null);function r(){pe()}function n(){ce()}return x((function(){de({container:"spell-canvas",width:o.value.offsetWidth,height:o.value.offsetHeight})})),(e,l)=>(t(),s("div",Ne,[a("div",{ref:(e,t)=>{t.canvasWrapper=e,o.value=e},id:"spell-canvas"},null,512),w(a("div",{ref:(e,t)=>{t.contextMenu=e},class:"context-menu",style:i(u(ke).state.contextMenuPosition)},[a("button",{onClick:r},"Связать"),a("button",{onClick:n},"Убрать")],4),[[k,u(ke).state.isContextMenuShown]])]))}},[["__scopeId","data-v-7e7834bb"]]);const Pe={class:"container-fluid sg-wrapper"},Ie={class:"row"},Le={class:"col-8"},Te={class:"col-4"};var Ee=P({setup:e=>(e,o)=>(t(),s("section",Pe,[a("div",Ie,[a("div",Le,[N(Se)]),a("div",Te,[N(W)])])]))},[["__scopeId","data-v-11ce70a2"]]);const Me={setup(s){const a=d();return e("audio").loaded.then((()=>{a.commit("loaded",{system:"audio",loaded:!0})})),(e,s)=>u(a).getters.isLoading?(t(),g(Ee,{key:1})):(t(),g(Ee,{key:0}))}};var Ce=h({modules:{elements:U,sources:Q,bases:Z,spell:ee},state:{loaded:{audio:!1},dashboard:{element:null}},mutations:{loaded(e,{system:t,loaded:s}){e.loaded[t]=s},setDashboardElement(e,{element:t}){console.log("setted",t),e.dashboard.element=t}},getters:{isLoading:e=>e.loaded.audio},actions:{dropElement({commit:e,dispatch:t,getters:s},{apexId:a,elementId:o}){e("spell/setElementToApex",{apexId:a,element:s["elements/getElementById"](o)}),t("spell/digestSynergies")},dropSource({commit:e,getters:t},{coreId:s,sourceId:a}){e("spell/setSourceToCore",{coreId:s,source:t["source/getSourceById"](a)})}}}),Ae={beforeMount(e,t){e.__vHoverListener__=e=>{let s="mouseenter"===e.type;t.value&&t.value(s)},e.addEventListener("mouseenter",e.__vHoverListener__),e.addEventListener("mouseleave",e.__vHoverListener__)},beforeUnmount(e){e.removeEventListener("mouseenter",e.__vHoverListener__),e.removeEventListener("mouseleave",e.__vHoverListener__)}},Be={install:e=>{e.directive("hover",Ae)}};const De=S(Me);De.use(Ce),De.use(Be),De.use(oe),De.mount("#app");
